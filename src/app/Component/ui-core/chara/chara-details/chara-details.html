<style>
    html {
        height: 100%;
        margin: auto;
        width: 960px;
        overflow : scroll
    }

    .title_input{
        display: block;
        margin: 0 auto
    }
    .subtitle_input{
        display: block;
        margin: 0 auto
    }
    .details_section{
        max-height : calc(100vh - 64px)
    }
</style>
<form class="details_section">
    <div class="ml-1 grid grid-cols-4 grid-rows-auto">
        <!-- Character Edit Mode -->
        @if(edit_mode()){
            <input type="file" id="file_upload" name="upload_field" /><br />
            <div class="row-span-1 col-span-2 row-start-1 col-start-1 p-3">
                <!-- Name and Subtitle -->
                <input
                    name = "name"
                    [id] = "chara_submit_config[2].id"
                    [ngModel] = "chara_data_set().name"
                    (ngModelChange)="update_data_signal(chara_submit_config[2].id, $event)"
                    class="bg-gray-300 title_input box-border size-fit text-6xl display-block mx-auto text-center object-center" 
                    value="{{chara_data_set()?.name}}"
                >
                <div class="pt-3 pb-3">
                    <input 
                    name = "subtitle"
                    [id] = "chara_submit_config[4].id"
                    [ngModel] = "chara_data_set().subtitle"
                    (ngModelChange)="update_data_signal(chara_submit_config[4].id, $event)"
                    class="bg-gray-300 subtitle_input box-border size-fit text-xl display-block mx-auto object-center text-center"
                    value="{{chara_data_set()?.subtitle}}"
                >
                </div>
                <mat-divider class="pt-2"></mat-divider>
                <!-- Important Relationship Traits -->
                <div class="grid grid-rows-3 grid-cols-2">
                    <h1 class="text-3xl col-span-1 row-span-1 col-start-1 row-start-1">Relationship With Party: </h1>
                    <input
                        name = relation
                        [id] = "chara_submit_config[6].id"
                        [ngModel] = "chara_data_set().relation"
                        (ngModelChange)="update_data_signal(chara_submit_config[6].id, $event)"
                        class="bg-gray-300 box-border size-fit text-2xl display-block mx-auto text-center" 
                        value="{{chara_data_set()?.relation}}">
                    <h1 class="text-3xl col-span-1 row-span-1 col-start-1 row-start-2"> Status: </h1>
                    <input
                        name = "status" 
                        [id] = "chara_submit_config[7].id"
                        [ngModel] = "chara_data_set().status"
                        (ngModelChange)="update_data_signal(chara_submit_config[7].id, $event)"
                        class="bg-gray-300 box-border size-fit display-block mx-auto text-2xl text-center" 
                        value="{{chara_data_set()?.status}}">
                    <h1 class="text-3xl col-span-1 row-span-1 col-start-1 row-start-3">Faction Member: </h1>
                    <input
                        name = "faction"
                        [id] = "chara_submit_config[5].id"
                        [ngModel] = "chara_data_set().faction"
                        (ngModelChange)="update_data_signal(chara_submit_config[5].id, $event)"
                        class="bg-gray-300 box-border size-fit display-block mx-auto text-2xl text-center" 
                        value="{{chara_data_set()?.faction}}">
                </div>
            </div>
            <!-- Biography -->
            <div class="row-span-1 col-span-2 row-start-2 col-start-1">
                <div class="grid grid-rows-1 grid-cols-1">
                    <mat-divider class="object-bottom"></mat-divider>
                    <h1 class="justify-left text-4xl font-semibold p-4">Biography</h1>
                    <textarea
                        name = "bio"
                        [id] = "chara_submit_config[3].id"
                        [ngModel] = "chara_data_set().bio"
                        (ngModelChange)="update_data_signal(chara_submit_config[3].id, $event)"
                        class="bg-gray-300 field-sizing-content box-border object-fill display-block justify-left text-xl pt">{{chara_data_set()?.bio}}</textarea>
                </div>
            </div>
            <!-- Character Log Entries  -->
            @for(entry of chara_log_set(); track entry.index){
                <div class="row-span-1 col-span-2 row-start-auto col-start-1 pb-12 pt-4">
                    <div class="grid grid-rows-1 grid-cols-1">
                        <textarea
                            name = "bio"
                            [id] = "entry.index"
                            class="bg-gray-300 field-sizing-content box-border resize-none object-fill display-block justify-left text-4xl font-semibold pt-4">{{entry.title}}</textarea>
                        <textarea class="bg-gray-300 size-full box-border object-fill display-block justify-left text-xl pt-2">{{entry.entry}}</textarea>
                        <mat-divider class="object-bottom"></mat-divider>
                    </div>
                </div>
            }
            <!-- Field For New Entry -->
             @if(chara_key() != "-1"){
                <div class="row-span-1 col-span-2 row-start-auto col-start-1 pb-12 pt-4">
                    <div class="grid grid-rows-1 grid-cols-1">
                        <textarea class="bg-gray-300 field-sizing-content box-border resize-none object-fill display-block justify-left text-4xl font-semibold pt-4">New Entry</textarea>
                        <textarea class="bg-gray-300 size-full box-border object-fill display-block justify-left text-xl pt-2">New Entry Contents</textarea>
                        <button type="" class="col-span-1 row-span-1 size-auto row-start-auto col-start-1" mat-button (click)="$event.preventDefault(); submit_log_entry()">Submit Log Entry</button>
                        <mat-divider class="object-bottom"></mat-divider>
                    </div>
                </div>
            }
            <!-- Navigation/Modification Buttons -->
            <div class="col-span-1 row-span-1 row-start-auto col-start-1">
                <button type="" class="col-span-1 row-span-1 size-auto row-start-auto col-start-1" mat-button (click)="$event.preventDefault(); return_to_select()">Return To Character Select</button>
                <button matButton type="Submit" class="col-span-1 row-span-1 size-auto row-start-5 col-start-1" (click)="$event.preventDefault(); modify_chara_data();">Apply All Changes</button>
            </div>
            
        }
        @else{
        <!-- Character Display Mode -->
            <!-- Character Image -->
            <div class="min-w-50% min-h-[720px] max-h-[720px] row-span-2 col-span-2 row-start-1 col-start-3">
                <img class="justify-self-center object-center object-fill max-w-fill max-h-fill" src="/Clueless.webp">
            </div>
            <div class="row-span-1 col-span-2 row-start-1 col-start-1 p-3">
                <!-- Name and Subtitle -->
                <h1 class="text-6xl text-center">{{chara_data_set()?.name}}</h1>
                <h1 class="text-xl pt-2 pb-2 text-center">{{chara_data_set()?.subtitle}}</h1>
                <mat-divider class="pt-2"></mat-divider>
                <!-- Important Relationship Traits -->
                <div class="grid grid-rows-3 grid-cols-2">
                    <h1 class="text-3xl col-span-1 row-span-1 col-start-1 row-start-1">Relationship With Party: </h1>
                    <h1 class="text-3xl text-center col-span-1 row-span-1 col-start-2 row-start-1">{{chara_data_set()?.relation}}</h1>
                    <h1 class="text-3xl col-span-1 row-span-1 col-start-1 row-start-2"> Status: </h1>
                    <h1 class="text-3xl text-center col-span-1 row-span-1 col-start-2 row-start-2">{{chara_data_set()?.status}}</h1>
                    <h1 class="text-3xl col-span-1 row-span-1 col-start-1 row-start-3">Faction Member: </h1>
                    <h1 class="text-3xl text-center col-span-1 row-span-1 col-start-2 row-start-3">{{chara_data_set()?.faction}}</h1>
                </div>
            </div>
            <div class="row-span-1 col-span-2 row-start-2 col-start-1">
                <mat-divider class="object-bottom"></mat-divider>
                <h1 class="justify-left text-4xl font-semibold pt-2">Biography</h1>
                <h1 class="justify-left text-xl pt-2 wrap-anywhere">{{chara_data_set()?.bio}}</h1>
            </div>
            @for(entry of chara_log_set(); track entry.index){
                <div class="row-span-1 col-span-2 row-start-auto col-start-1 pb-12">
                    <mat-divider class="object-bottom"></mat-divider>
                    <h1 class="justify-left text-4xl font-semibold pt-2">{{entry.title}}</h1>
                    <h1 class="justify-left text-xl pt-2 wrap-anywhere">{{entry.entry}}</h1>
                </div>
            }
            <button type="" class="col-span-1 row-span-1 size-auto row-start-auto col-start-1" mat-button (click)="$event.preventDefault(); return_to_select()">Return To Character Select</button>
            <button matButton class="col-span-1 row-span-1 size-auto row-start-auto col-start-2" (click)="$event.preventDefault(); set_to_edit_handler()">Edit</button>
        }
    </div>
</form>